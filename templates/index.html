<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>文本盲水印工具</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .panel { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        .label { display: inline-block; width: 80px; font-weight: bold; }
        .input { width: 300px; margin: 5px; }
        .textarea { width: 100%; height: 150px; }
        button { background: lightblue; padding: 10px; margin: 10px; }
        #output-embed, #output-extract { border: 1px solid #ddd; }
    </style>
</head>
    <div id="embed-panel" class="panel">
        <h2>1. 嵌入水印</h2>
        <div>
            <span class="label">密码*:</span>
            <input type="password" id="pwd-embed" class="input" placeholder="输入密码">
        </div>
        <div>
            <span class="label">水印:</span>
            <input type="text" id="wm-embed" class="input" value="This is watermark">
        </div>
        <div>
            <span class="label">输入文本:</span>
            <textarea id="input-embed" class="textarea" placeholder="输入原始文本"></textarea>
        </div>
        <button onclick="embedWatermark()">Embed -></button>
        <div>
            <span class="label">输出文本:</span>
            <textarea id="output-embed" class="textarea" readonly></textarea>
        </div>
    </div>
    <div id="extract-panel" class="panel">
        <h2>2. 提取水印</h2>
        <div>
            <span class="label">密码:</span>
            <input type="password" id="pwd-extract" class="input" placeholder="输入密码">
        </div>
        <div>
            <span class="label">输入文本:</span>
            <textarea id="input-extract" class="textarea" placeholder="输入水印文本"></textarea>
        </div>
        <button onclick="extractWatermark()">Extract -></button>
        <div>
            <span class="label">提取结果:</span>
            <input type="text" id="output-extract" class="input" readonly style="width: 100%;">
        </div>
    </div>

    <script>
        async function embedWatermark() {
            const pwd = document.getElementById('pwd-embed').value;
            const wm = document.getElementById('wm-embed').value;
            const text = document.getElementById('input-embed').value;
            const response = await fetch('/embed', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password: pwd, watermark: wm, input_text: text})
            });
            const data = await response.json();
            const output = document.getElementById('output-embed');
            if (data.error) {
                alert('错误: ' + data.error);
                output.value = '';
            } else {
                output.value = data.output_text;
                alert('成功: 水印嵌入完成！');
            }
        }

        async function extractWatermark() {
            const pwd = document.getElementById('pwd-extract').value;
            const text = document.getElementById('input-extract').value;
            const response = await fetch('/extract', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password: pwd, input_text: text})
            });
            const data = await response.json();
            const output = document.getElementById('output-extract');
            if (data.error) {
                alert('错误: ' + data.error);
                output.value = '';
            } else {
                output.value = data.output_text;
                alert('成功: 水印提取完成！');
            }
        }
    </script>
</body>
</html>